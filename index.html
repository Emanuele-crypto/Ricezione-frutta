const PortataOrariaCalculator = ({ silosData }) => {
  // Stato per il silos selezionato e i campi del form
  const [selectedSilos, setSelectedSilos] = useState(null);
  const [quantita, setQuantita] = useState('');
  const [inizioLavorazione, setInizioLavorazione] = useState('');
  const [fineLavorazione, setFineLavorazione] = useState('');
  const [results, setResults] = useState([]);
  
  // Lista di tutti i silos disponibili
  const allSilos = Object.keys(silosData).flatMap(
    linea => silosData[linea].map(silos => ({
      id: silos.id,
      linea,
      tipologia: silos.tipologia,
      quantita: silos.quantita,
      inizioLavorazione: silos.inzioLavorazione,
      fineLavorazione: silos.fineLavorazione,
      occupazione: silos.occupazione
    }))
  ).filter(silos => silos.occupazione > 0);
  
  // Gestisce la selezione di un silos dall'elenco
  const handleSilosSelect = (e) => {
    const silosId = e.target.value;
    if (!silosId) {
      setSelectedSilos(null);
      setQuantita('');
      setInizioLavorazione('');
      setFineLavorazione('');
      return;
    }
    
    const silos = allSilos.find(s => s.id === silosId);
    setSelectedSilos(silos);
    setQuantita(silos.quantita.toString());
    setInizioLavorazione(silos.inizioLavorazione || '');
    setFineLavorazione(silos.fineLavorazione || '');
  };
  
  // Converte una data dd/MM/yyyy HH:mm in oggetto Date
  const parseDateTime = (dateTimeStr) => {
    if (!dateTimeStr) return null;
    
    const [datePart, timePart] = dateTimeStr.split(' ');
    if (!datePart || !timePart) return null;
    
    const [day, month, year] = datePart.split('/').map(Number);
    const [hours, minutes] = timePart.split(':').map(Number);
    
    return new Date(year, month - 1, day, hours, minutes);
  };
  
  // Calcola la portata oraria
  const calculatePortata = () => {
    if (!quantita || !inizioLavorazione || !fineLavorazione) {
      alert('Inserisci tutti i dati richiesti');
      return;
    }
    
    const quantitaNum = parseFloat(quantita);
    if (isNaN(quantitaNum) || quantitaNum <= 0) {
      alert('La quantità deve essere un numero positivo');
      return;
    }
    
    const inizioTime = parseDateTime(inizioLavorazione);
    const fineTime = parseDateTime(fineLavorazione);
    
    if (!inizioTime || !fineTime) {
      alert('Formato data/ora non valido. Usa DD/MM/YYYY HH:MM');
      return;
    }
    
    if (fineTime <= inizioTime) {
      alert('La fine lavorazione deve essere successiva all\'inizio');
      return;
    }
    
    // Calcola durata in ore
    const durataMillis = fineTime - inizioTime;
    const durataOre = durataMillis / (1000 * 60 * 60);
    
    // Calcola portata oraria
    const portataOraria = quantitaNum / durataOre;
    
    // Aggiungi il risultato alla lista
    const newResult = {
      id: selectedSilos ? selectedSilos.id : `Calc-${results.length + 1}`,
      tipologia: selectedSilos ? selectedSilos.tipologia : 'Personalizzato',
      quantita: quantitaNum,
      inizioLavorazione: inizioLavorazione,
      fineLavorazione: fineLavorazione,
      durataOre: durataOre.toFixed(2),
      portataOraria: Math.round(portataOraria)
    };
    
    setResults([newResult, ...results]);
  };
  
  return (
    <div>
      <div className="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
        <div className="bg-gray-50 p-4 rounded border">
          <h3 className="font-bold mb-4 text-blue-700">Calcolo Portata Oraria</h3>
          
          <div className="mb-4">
            <label className="block text-sm font-medium mb-1">Seleziona Silos</label>
            <select 
              className="w-full border rounded p-2"
              onChange={handleSilosSelect}
              value={selectedSilos?.id || ''}
            >
              <option value="">-- Nuovo calcolo --</option>
              {allSilos.map(silos => (
                <option key={silos.id} value={silos.id}>
                  {silos.id} - {silos.tipologia || 'N/D'}
                </option>
              ))}
            </select>
          </div>
          
          <div className="mb-4">
            <label className="block text-sm font-medium mb-1">
              Quantità (kg)
            </label>
            <input 
              type="number" 
              className="w-full border rounded p-2"
              value={quantita}
              onChange={(e) => setQuantita(e.target.value)}
              placeholder="Es. 10000"
            />
          </div>
          
          <div className="mb-4">
            <label className="block text-sm font-medium mb-1">
              <div className="flex items-center">
                <Calendar size={16} className="mr-1" />
                Inizio Lavorazione
              </div>
            </label>
            <input 
              type="text" 
              className="w-full border rounded p-2"
              value={inizioLavorazione}
              onChange={(e) => setInizioLavorazione(e.target.value)}
              placeholder="DD/MM/YYYY HH:MM"
            />
          </div>
          
          <div className="mb-4">
            <label className="block text-sm font-medium mb-1">
              <div className="flex items-center">
                <Clock size={16} className="mr-1" />
                Fine Lavorazione
              </div>
            </label>
            <input 
              type="text" 
              className="w-full border rounded p-2"
              value={fineLavorazione}
              onChange={(e) => setFineLavorazione(e.target.value)}
              placeholder="DD/MM/YYYY HH:MM"
            />
          </div>
          
          <button 
            className="w-full bg-blue-600 hover:bg-blue-700 text-white py-2 px-4 rounded"
            onClick={calculatePortata}
          >
            Calcola Portata Oraria
          </button>
        </div>
        
        <div className="bg-blue-50 p-4 rounded border">
          <h3 className="font-bold mb-2 text-blue-700">Istruzioni</h3>
          <ol className="list-decimal ml-5 space-y-2 text-sm">
            <li>Seleziona un silos esistente dall'elenco o scegli "Nuovo calcolo" per una simulazione libera</li>
            <li>Verifica o modifica la quantità di agrumi lavorata in kg</li>
            <li>Inserisci data e ora di inizio lavorazione (formato: DD/MM/YYYY HH:MM)</li>
            <li>Inserisci data e ora di fine lavorazione (formato: DD/MM/YYYY HH:MM)</li>
            <li>Clicca su "Calcola Portata Oraria" per vedere il risultato</li>
          </ol>
          <p className="mt-4 text-sm text-gray-600">
            La portata oraria rappresenta la velocità di lavorazione in kg/h ed è calcolata dividendo la quantità totale per la durata in ore.
          </p>
          <p className="mt-2 text-sm font-semibold text-blue-700">
            Nota: Valori più alti indicano una maggiore efficienza di lavorazione.
          </p>
        </div>
      </div>
      
      <div className="border rounded overflow-hidden">
        <table className="w-full">
          <thead>
            <tr className="bg-gray-100">
              <th className="p-2 text-left">Silos</th>
              <th className="p-2 text-left">Tipologia</th>
              <th className="p-2 text-left">Quantità (kg)</th>
              <th className="p-2 text-left">Inizio</th>
              <th className="p-2 text-left">Fine</th>
              <th className="p-2 text-left">Durata (h)</th>
              <th className="p-2 text-left">Portata (kg/h)</th>
            </tr>
          </thead>
          <tbody>
            {results.length > 0 ? (
              results.map((result, index) => (
                <tr key={index} className="border-t hover:bg-blue-50">
                  <td className="p-2 font-medium">{result.id}</td>
                  <td className="p-2">{result.tipologia}</td>
                  <td className="p-2">{result.quantita.toLocaleString()}</td>
                  <td className="p-2">{result.inizioLavorazione}</td>
                  <td className="p-2">{result.fineLavorazione}</td>
                  <td className="p-2">{result.durataOre}</td>
                  <td className="p-2 font-bold text-blue-600">{result.portataOraria.toLocaleString()} kg/h</td>
                </tr>
              ))
            ) : (
              <tr>
                <td colSpan="7" className="p-4 text-center text-gray-500">
                  Nessun calcolo effettuato. Utilizza il form per calcolare la portata oraria.
                </td>
              </tr>
            )}
          </tbody>
        </table>
      </div>
    </div>
  );
};import React, { useState } from 'react';
import { Truck, Warehouse, Package, BarChart2, FileText, ArrowRight, Calendar, Clock } from 'lucide-react';

const GestioneAgrumiApp = () => {
  const [activeTab, setActiveTab] = useState('accettazione');
  const [fornitori] = useState([
    { id: 1, nome: 'Agrumi Sicilia S.r.l.', partitaIva: 'IT12345678901' },
    { id: 2, nome: 'Azienda Agricola Rossi', partitaIva: 'IT98765432101' },
    { id: 3, nome: 'Limoni del Sud S.p.A.', partitaIva: 'IT45678912301' },
  ]);
  
  const [formData, setFormData] = useState({
    fornitore: '',
    targa: '',
    autista: '',
    pesoLordo: '',
    tipoAgrume: 'arance-bionde',
    tipologiaFrutta: 'convenzionale',
    linee: [],
    silosSelezionati: []
  });
  
  const [arriviRecenti] = useState([
    { id: 'ARR001', fornitore: 'Agrumi Sicilia S.r.l.', targa: 'AB123CD', arrivo: '15/05/2025 08:30', pesoNetto: '12.450', linea: 'A', silos: 'A3', stato: 'Completato', tempoTrascorso: null },
    { id: 'ARR002', fornitore: 'Azienda Agricola Rossi', targa: 'EF456GH', arrivo: '15/05/2025 09:15', pesoNetto: '8.320', linea: 'B', silos: 'B2', stato: 'In corso', tempoTrascorso: '01:45:12' },
    { id: 'ARR003', fornitore: 'Limoni del Sud S.p.A.', targa: 'IL789MN', arrivo: '15/05/2025 10:00', pesoNetto: '10.740', linea: 'C', silos: 'C5', stato: 'In attesa', tempoTrascorso: '00:30:45' }
  ]);
  
  const [silosStato] = useState({
    A: [
      { id: 'A1', occupazione: 85, tipologia: 'Arance Bionde', fornitore: 'Agrumi Sicilia S.r.l.', quantita: 15230, inzioLavorazione: '15/05/2025 07:30', fineLavorazione: '15/05/2025 12:15', portataOraria: 3200 },
      { id: 'A2', occupazione: 60, tipologia: 'Arance Rosse', fornitore: 'Azienda Agricola Rossi', quantita: 10850, inzioLavorazione: '15/05/2025 08:45', fineLavorazione: '15/05/2025 11:30', portataOraria: 3900 },
      { id: 'A3', occupazione: 90, tipologia: 'Arance Bionde', fornitore: 'Limoni del Sud S.p.A.', quantita: 18560, inzioLavorazione: '15/05/2025 06:15', fineLavorazione: '15/05/2025 14:30', portataOraria: 2240 },
      { id: 'A4', occupazione: 45, tipologia: 'Arance Rosse', fornitore: 'Agrumi Sicilia S.r.l.', quantita: 8650, inzioLavorazione: '15/05/2025 09:20', fineLavorazione: '15/05/2025 12:40', portataOraria: 2600 },
      { id: 'A5', occupazione: 10, tipologia: 'Arance Bionde', fornitore: null, quantita: 2100, inzioLavorazione: '15/05/2025 14:00', fineLavorazione: '15/05/2025 14:45', portataOraria: 2800 },
      { id: 'A6', occupazione: 0, tipologia: null, fornitore: null, quantita: 0, inzioLavorazione: null, fineLavorazione: null, portataOraria: 0 },
      { id: 'A7', occupazione: 30, tipologia: 'Bergamotti', fornitore: 'Azienda Agricola Rossi', quantita: 5760, inzioLavorazione: '15/05/2025 10:30', fineLavorazione: '15/05/2025 13:15', portataOraria: 2100 }
    ],
    B: [
      { id: 'B1', occupazione: 75, tipologia: 'Limoni', fornitore: 'Limoni del Sud S.p.A.', quantita: 14250, inzioLavorazione: '15/05/2025 07:00', fineLavorazione: '15/05/2025 13:00', portataOraria: 2375 },
      { id: 'B2', occupazione: 55, tipologia: 'Limoni', fornitore: 'Agrumi Sicilia S.r.l.', quantita: 9680, inzioLavorazione: '15/05/2025 08:30', fineLavorazione: '15/05/2025 12:30', portataOraria: 2420 },
      { id: 'B3', occupazione: 0, tipologia: null, fornitore: null, quantita: 0, inzioLavorazione: null, fineLavorazione: null, portataOraria: 0 },
      { id: 'B4', occupazione: 25, tipologia: 'Limoni', fornitore: 'Azienda Agricola Rossi', quantita: 4850, inzioLavorazione: '15/05/2025 13:15', fineLavorazione: '15/05/2025 15:45', portataOraria: 1940 },
      { id: 'B5', occupazione: 70, tipologia: 'Limoni', fornitore: 'Limoni del Sud S.p.A.', quantita: 12800, inzioLavorazione: '15/05/2025 09:00', fineLavorazione: '15/05/2025 14:30', portataOraria: 2330 },
      { id: 'B6', occupazione: 40, tipologia: 'Limoni', fornitore: 'Agrumi Sicilia S.r.l.', quantita: 7450, inzioLavorazione: '15/05/2025 11:45', fineLavorazione: '15/05/2025 15:15', portataOraria: 2130 },
      { id: 'B7', occupazione: 0, tipologia: null, fornitore: null, quantita: 0, inzioLavorazione: null, fineLavorazione: null, portataOraria: 0 }
    ],
    C: [
      { id: 'C1', occupazione: 65, tipologia: 'Mandarini', fornitore: 'Agrumi Sicilia S.r.l.', quantita: 11300, inzioLavorazione: '15/05/2025 07:45', fineLavorazione: '15/05/2025 12:15', portataOraria: 2510 },
      { id: 'C2', occupazione: 0, tipologia: null, fornitore: null, quantita: 0, inzioLavorazione: null, fineLavorazione: null, portataOraria: 0 },
      { id: 'C3', occupazione: 50, tipologia: 'Mandarini', fornitore: 'Azienda Agricola Rossi', quantita: 9200, inzioLavorazione: '15/05/2025 08:15', fineLavorazione: '15/05/2025 12:45', portataOraria: 2050 },
      { id: 'C4', occupazione: 80, tipologia: 'Mandarini', fornitore: 'Limoni del Sud S.p.A.', quantita: 15680, inzioLavorazione: '15/05/2025 06:30', fineLavorazione: '15/05/2025 13:30', portataOraria: 2240 },
      { id: 'C5', occupazione: 35, tipologia: 'Mandarini', fornitore: 'Agrumi Sicilia S.r.l.', quantita: 6800, inzioLavorazione: '15/05/2025 10:15', fineLavorazione: '15/05/2025 13:45', portataOraria: 1940 },
      { id: 'C6', occupazione: 0, tipologia: null, fornitore: null, quantita: 0, inzioLavorazione: null, fineLavorazione: null, portataOraria: 0 },
      { id: 'C7', occupazione: 20, tipologia: 'Mandarini', fornitore: 'Limoni del Sud S.p.A.', quantita: 3850, inzioLavorazione: '15/05/2025 14:00', fineLavorazione: '15/05/2025 16:00', portataOraria: 1925 }
    ]
  });
  
  const [giacenze] = useState([
    { id: 'G001', silos: 'A3', fornitore: 'Limoni del Sud S.p.A.', tipologia: 'Arance Bionde', certificazione: 'Bio EU', quantita: '8.200', dataInizio: '12/05/2025', motivo: 'Eccesso fornitura' },
    { id: 'G002', silos: 'B5', fornitore: 'Limoni del Sud S.p.A.', tipologia: 'Limoni', certificazione: 'IGP', quantita: '6.100', dataInizio: '13/05/2025', motivo: 'Attesa analisi qualità' },
    { id: 'G003', silos: 'C4', fornitore: 'Limoni del Sud S.p.A.', tipologia: 'Mandarini', certificazione: 'Convenzionale', quantita: '7.400', dataInizio: '14/05/2025', motivo: 'Linea trasformazione occupata' }
  ]);
  
  const handleChange = (e) => {
    setFormData({
      ...formData,
      [e.target.name]: e.target.value
    });
  };
  
  const handleSubmit = () => {
    alert('Dati salvati con successo!');
    setFormData({
      fornitore: '',
      targa: '',
      autista: '',
      pesoLordo: '',
      tipoAgrume: 'arance-bionde',
      tipologiaFrutta: 'convenzionale',
      linee: [],
      silosSelezionati: []
    });
  };
  
  const getSilosColor = (occupazione) => {
    if (occupazione === 0) return 'bg-gray-200';
    if (occupazione < 30) return 'bg-green-200';
    if (occupazione < 70) return 'bg-yellow-200';
    return 'bg-red-200';
  };
  
  // Gestire il passaggio al reparto Trasformazione
  const handleRepartoChange = () => {
    alert('Passaggio al reparto Trasformazione. La dashboard verrà creata in un secondo momento.');
  };
  
  // Tab di Accettazione
  const AccettazioneTab = () => (
    <div className="p-4 max-w-4xl mx-auto">
      <div className="bg-white rounded-lg shadow p-6">
        <h2 className="text-xl font-bold mb-4">Registrazione Nuovo Arrivo</h2>
        
        <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div>
            <label className="block text-sm font-medium mb-1">Tipologia Frutta</label>
            <select 
              name="tipologiaFrutta" 
              value={formData.tipologiaFrutta || 'convenzionale'} 
              onChange={handleChange}
              className="w-full border rounded p-2"
            >
              <option value="convenzionale">Convenzionale</option>
              <option value="igp">IGP</option>
              <option value="bio-demeter">Bio Demeter</option>
              <option value="bio-eu">Bio EU</option>
              <option value="bio-naturland">Bio Naturland</option>
              <option value="altre">Altre</option>
            </select>
          </div>
          
          <div>
            <label className="block text-sm font-medium mb-1">Fornitore</label>
            <select 
              name="fornitore" 
              value={formData.fornitore} 
              onChange={handleChange}
              className="w-full border rounded p-2"
            >
              <option value="">Seleziona fornitore</option>
              {fornitori.map(f => (
                <option key={f.id} value={f.id}>{f.nome}</option>
              ))}
            </select>
          </div>
          
          <div>
            <label className="block text-sm font-medium mb-1">Targa Camion</label>
            <input 
              type="text" 
              name="targa" 
              value={formData.targa} 
              onChange={handleChange}
              className="w-full border rounded p-2"
              placeholder="AB123CD"
            />
          </div>
          
          <div>
            <label className="block text-sm font-medium mb-1">Nome Autista</label>
            <input 
              type="text" 
              name="autista" 
              value={formData.autista} 
              onChange={handleChange}
              className="w-full border rounded p-2"
              placeholder="Mario Rossi"
            />
          </div>
          
          <div>
            <label className="block text-sm font-medium mb-1">Peso Lordo (kg)</label>
            <input 
              type="number" 
              name="pesoLordo" 
              value={formData.pesoLordo} 
              onChange={handleChange}
              className="w-full border rounded p-2"
              placeholder="0.00"
              step="0.01"
              min="0"
            />
          </div>
          
          <div>
            <label className="block text-sm font-medium mb-1">Tipologia Agrume</label>
            <select 
              name="tipoAgrume" 
              value={formData.tipoAgrume} 
              onChange={handleChange}
              className="w-full border rounded p-2"
            >
              <option value="arance-bionde">Arance Bionde</option>
              <option value="arance-rosse">Arance Rosse</option>
              <option value="limoni">Limoni</option>
              <option value="mandarini">Mandarini</option>
              <option value="pompelmi">Pompelmi</option>
              <option value="bergamotti">Bergamotti</option>
            </select>
          </div>
          
          <div>
            <label className="block text-sm font-medium mb-1">Linee di Stoccaggio (seleziona multiple)</label>
            <div className="grid grid-cols-3 gap-2">
              <div className="flex items-center">
                <input 
                  type="checkbox" 
                  id="lineaA"
                  checked={formData.linee.includes('A')}
                  onChange={(e) => {
                    const newLinee = e.target.checked 
                      ? [...formData.linee, 'A'] 
                      : formData.linee.filter(l => l !== 'A');
                    setFormData({...formData, linee: newLinee});
                  }}
                  className="mr-2"
                />
                <label htmlFor="lineaA">LINEA A</label>
              </div>
              <div className="flex items-center">
                <input 
                  type="checkbox" 
                  id="lineaB"
                  checked={formData.linee.includes('B')}
                  onChange={(e) => {
                    const newLinee = e.target.checked 
                      ? [...formData.linee, 'B'] 
                      : formData.linee.filter(l => l !== 'B');
                    setFormData({...formData, linee: newLinee});
                  }}
                  className="mr-2"
                />
                <label htmlFor="lineaB">LINEA B</label>
              </div>
              <div className="flex items-center">
                <input 
                  type="checkbox" 
                  id="lineaC"
                  checked={formData.linee.includes('C')}
                  onChange={(e) => {
                    const newLinee = e.target.checked 
                      ? [...formData.linee, 'C'] 
                      : formData.linee.filter(l => l !== 'C');
                    setFormData({...formData, linee: newLinee});
                  }}
                  className="mr-2"
                />
                <label htmlFor="lineaC">LINEA C</label>
              </div>
            </div>
          </div>
          
          <div>
            <label className="block text-sm font-medium mb-1">Silos (seleziona multipli)</label>
            <div className="border rounded p-2 max-h-28 overflow-y-auto">
              <div className="grid grid-cols-3 gap-2">
                {formData.linee.length > 0 ? (
                  formData.linee.map(linea => (
                    Array.from({length: 7}, (_, i) => {
                      const silosId = `${linea}${i+1}`;
                      return (
                        <div key={silosId} className="flex items-center">
                          <input 
                            type="checkbox" 
                            id={silosId}
                            checked={formData.silosSelezionati.includes(silosId)}
                            onChange={(e) => {
                              const newSilos = e.target.checked 
                                ? [...formData.silosSelezionati, silosId] 
                                : formData.silosSelezionati.filter(s => s !== silosId);
                              setFormData({...formData, silosSelezionati: newSilos});
                            }}
                            className="mr-2"
                          />
                          <label htmlFor={silosId}>{silosId}</label>
                        </div>
                      );
                    })
                  )).flat()
                ) : (
                  <div className="text-gray-500 italic">Seleziona prima una linea</div>
                )}
              </div>
            </div>
          </div>
        </div>
        
        <div className="mt-6 flex justify-end">
          <button 
            onClick={handleSubmit}
            className="bg-blue-600 text-white px-6 py-2 rounded hover:bg-blue-700"
          >
            Registra Arrivo
          </button>
        </div>
      </div>
      
      <div className="mt-8 bg-white rounded-lg shadow">
        <h2 className="text-xl font-bold p-4 border-b">Arrivi Recenti</h2>
        <div className="overflow-x-auto">
          <table className="w-full">
            <thead>
              <tr className="bg-gray-100">
                <th className="p-3 text-left">ID</th>
                <th className="p-3 text-left">Fornitore</th>
                <th className="p-3 text-left">Targa</th>
                <th className="p-3 text-left">Arrivo</th>
                <th className="p-3 text-left">Peso Netto (kg)</th>
                <th className="p-3 text-left">Destinazione</th>
                <th className="p-3 text-left">Stato</th>
                <th className="p-3 text-left">Tempo</th>
              </tr>
            </thead>
            <tbody>
              {arriviRecenti.map(arrivo => (
                <tr key={arrivo.id} className="border-t hover:bg-gray-50">
                  <td className="p-3">{arrivo.id}</td>
                  <td className="p-3">{arrivo.fornitore}</td>
                  <td className="p-3">{arrivo.targa}</td>
                  <td className="p-3">{arrivo.arrivo}</td>
                  <td className="p-3">{arrivo.pesoNetto}</td>
                  <td className="p-3">{arrivo.linea}-{arrivo.silos}</td>
                  <td className="p-3">
                    <span className={`px-2 py-1 rounded text-sm ${
                      arrivo.stato === 'Completato' ? 'bg-green-100 text-green-800' : 
                      arrivo.stato === 'In corso' ? 'bg-yellow-100 text-yellow-800' : 
                      'bg-blue-100 text-blue-800'
                    }`}>
                      {arrivo.stato}
                    </span>
                  </td>
                  <td className="p-3">
                    {arrivo.tempoTrascorso && (
                      <span className={`px-2 py-1 rounded text-sm ${
                        arrivo.stato === 'In corso' ? 'bg-yellow-50 text-yellow-800' : 
                        'bg-blue-50 text-blue-800'
                      }`}>
                        {arrivo.tempoTrascorso}
                      </span>
                    )}
                  </td>
                </tr>
              ))}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  );
  
  // Tab dei Silos
  const SilosTab = () => (
    <div className="p-4 max-w-6xl mx-auto">
      <div className="grid grid-cols-1 gap-8">
        {Object.keys(silosStato).map(linea => (
          <div key={linea} className="bg-white rounded-lg shadow p-6">
            <h2 className="text-xl font-bold mb-4">Linea {linea}</h2>
            <div className="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-7 gap-4">
              {silosStato[linea].map(silos => (
                <div 
                  key={silos.id} 
                  className={`border rounded-lg overflow-hidden shadow ${silos.occupazione > 0 ? 'cursor-pointer hover:shadow-md' : ''}`}
                  onClick={() => silos.occupazione > 0 && silos.inzioLavorazione && silos.fineLavorazione && 
                    alert(`Dettagli Lavorazione Silos ${silos.id}:
                    Tipologia: ${silos.tipologia}
                    Quantità: ${silos.quantita.toLocaleString()} kg
                    Inizio: ${silos.inzioLavorazione}
                    Fine: ${silos.fineLavorazione}
                    Portata: ${silos.portataOraria.toLocaleString()} kg/h`)}
                >
                  <div 
                    className={`${getSilosColor(silos.occupazione)} p-2 text-center font-bold`}
                  >
                    {silos.id}
                  </div>
                  <div className="p-3">
                    <div className="relative pt-1">
                      <div className="overflow-hidden h-2 mb-1 text-xs flex rounded bg-gray-200">
                        <div 
                          style={{ width: `${silos.occupazione}%` }} 
                          className={`shadow-none flex flex-col text-center whitespace-nowrap text-white justify-center ${
                            silos.occupazione > 80 ? 'bg-red-500' : 
                            silos.occupazione > 60 ? 'bg-yellow-500' : 
                            'bg-green-500'
                          }`}
                        ></div>
                      </div>
                      <div className="text-xs text-right">{silos.occupazione}%</div>
                    </div>
                    
                    {silos.occupazione > 0 ? (
                      <>
                        <div className="text-xs mt-2">
                          <div className="font-semibold">Tipo:</div>
                          <div>{silos.tipologia}</div>
                        </div>
                        <div className="text-xs mt-1">
                          <div className="font-semibold">Fornitore:</div>
                          <div className="truncate">{silos.fornitore}</div>
                        </div>
                        <div className="text-xs mt-1">
                          <div className="font-semibold">Portata:</div>
                          <div>{silos.portataOraria} kg/h</div>
                        </div>
                      </>
                    ) : (
                      <div className="text-xs text-center py-2 text-gray-500">Vuoto</div>
                    )}
                  </div>
                </div>
              ))}
            </div>
          </div>
        ))}
      </div>
    </div>
  );
  
  // Tab delle Giacenze
  const GiacenzeTab = () => (
    <div className="p-4 max-w-4xl mx-auto">
      <div className="bg-white rounded-lg shadow">
        <h2 className="text-xl font-bold p-4 border-b">Giacenze Attive</h2>
        <div className="overflow-x-auto">
          <table className="w-full">
            <thead>
              <tr className="bg-gray-100">
                <th className="p-3 text-left">ID</th>
                <th className="p-3 text-left">Silos</th>
                <th className="p-3 text-left">Fornitore</th>
                <th className="p-3 text-left">Tipologia</th>
                <th className="p-3 text-left">Certificazione</th>
                <th className="p-3 text-left">Quantità (kg)</th>
                <th className="p-3 text-left">Data Inizio</th>
                <th className="p-3 text-left">Motivo</th>
                <th className="p-3 text-left">Azioni</th>
              </tr>
            </thead>
            <tbody>
              {giacenze.map(giacenza => (
                <tr key={giacenza.id} className="border-t hover:bg-gray-50">
                  <td className="p-3">{giacenza.id}</td>
                  <td className="p-3">{giacenza.silos}</td>
                  <td className="p-3">{giacenza.fornitore}</td>
                  <td className="p-3">{giacenza.tipologia}</td>
                  <td className="p-3">{giacenza.certificazione}</td>
                  <td className="p-3">{giacenza.quantita}</td>
                  <td className="p-3">{giacenza.dataInizio}</td>
                  <td className="p-3">{giacenza.motivo}</td>
                  <td className="p-3">
                    <button className="bg-green-600 text-white px-3 py-1 rounded text-xs hover:bg-green-700">
                      Invia a Trasformazione
                    </button>
                  </td>
                </tr>
              ))}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  );
  
  // Tab dei Report
  const ReportTab = () => (
    <div className="p-4 max-w-4xl mx-auto">
      <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
        <div className="bg-white rounded-lg shadow p-6">
          <h2 className="text-xl font-bold mb-4">Statistiche Giornaliere</h2>
          <div className="space-y-4">
            <div className="border-b pb-2">
              <div className="font-medium">Totale Arrivi Oggi</div>
              <div className="text-2xl font-bold">8</div>
            </div>
            <div className="border-b pb-2">
              <div className="font-medium">Totale Peso Netto (kg)</div>
              <div className="text-2xl font-bold">78.250</div>
            </div>
            <div className="border-b pb-2">
              <div className="font-medium">Suddivisione per Tipologia</div>
              <div className="mt-2 space-y-1">
                <div className="flex justify-between">
                  <span>Arance Bionde</span>
                  <span className="font-medium">28.500 kg (36,4%)</span>
                </div>
                <div className="flex justify-between">
                  <span>Arance Rosse</span>
                  <span className="font-medium">13.600 kg (17,4%)</span>
                </div>
                <div className="flex justify-between">
                  <span>Limoni</span>
                  <span className="font-medium">21.450 kg (27,4%)</span>
                </div>
                <div className="flex justify-between">
                  <span>Mandarini</span>
                  <span className="font-medium">14.700 kg (18,8%)</span>
                </div>
              </div>
            </div>
          </div>
        </div>
        
        <div className="bg-white rounded-lg shadow p-6">
          <h2 className="text-xl font-bold mb-4">Stato Silos</h2>
          <div className="space-y-4">
            <div className="border-b pb-2">
              <div className="font-medium">Occupazione Media</div>
              <div className="text-2xl font-bold">62%</div>
            </div>
            <div className="border-b pb-2">
              <div className="font-medium">Silos Disponibili</div>
              <div className="text-2xl font-bold">6/21</div>
            </div>
            <div className="border-b pb-2">
              <div className="font-medium">Silos Critici (>80%)</div>
              <div className="text-2xl font-bold text-red-600">4</div>
            </div>
            <div className="border-b pb-2">
              <div className="font-medium">Portata Oraria Media</div>
              <div className="text-2xl font-bold">2335 kg/h</div>
            </div>
            <div className="border-b pb-2">
              <div className="font-medium">Portata Massima</div>
              <div className="text-2xl font-bold text-green-600">3900 kg/h</div>
            </div>
            <div className="border-b pb-2">
              <div className="font-medium">Portata Minima</div>
              <div className="text-2xl font-bold text-yellow-600">1925 kg/h</div>
            </div>
          </div>
        </div>
        
        <div className="bg-white rounded-lg shadow p-6 md:col-span-2">
          <h2 className="text-xl font-bold mb-4">Calcolo Portata Oraria per Silos</h2>
          <div className="overflow-x-auto">
            <PortataOrariaCalculator silosData={silosStato} />
          </div>
        </div>
        
        <div className="bg-white rounded-lg shadow p-6 md:col-span-2">
          <h2 className="text-xl font-bold mb-4">Arrivi per Fornitore (Ultimi 7 giorni)</h2>
          <div className="h-64 flex items-center justify-center border rounded">
            <div className="text-center p-4">
              <BarChart2 size={64} className="mx-auto text-gray-400" />
              <p className="mt-2 text-gray-500">Grafico a barre di arrivi per fornitore</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  );
  
  return (
    <div className="min-h-screen bg-gray-100">
      {/* Header */}
      <header className="bg-blue-700 text-white shadow-md">
        <div className="container mx-auto p-4">
          <div className="flex justify-between items-center">
            <div className="flex items-center space-x-2">
              <Package size={28} />
              <h1 className="text-xl font-bold">Sistema Gestione Agrumi</h1>
            </div>
            <div className="flex items-center">
              <button 
                className="flex items-center bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded shadow"
                onClick={handleRepartoChange}
              >
                <span>Reparto Trasformazione</span>
                <ArrowRight size={16} className="ml-2" />
              </button>
            </div>
          </div>
          <div className="mt-4 text-lg">Reparto: Ricezione Frutta</div>
        </div>
      </header>
      
      {/* Navigation Tabs */}
      <div className="container mx-auto px-4 mt-6">
        <div className="flex overflow-x-auto space-x-2 pb-2">
          <button
            className={`flex items-center px-4 py-2 rounded-t font-medium ${activeTab === 'accettazione' ? 'bg-white shadow-md' : 'bg-gray-200 hover:bg-gray-300'}`}
            onClick={() => setActiveTab('accettazione')}
          >
            <Truck size={18} className="mr-2" />
            Accettazione
          </button>
          <button
            className={`flex items-center px-4 py-2 rounded-t font-medium ${activeTab === 'silos' ? 'bg-white shadow-md' : 'bg-gray-200 hover:bg-gray-300'}`}
            onClick={() => setActiveTab('silos')}
          >
            <Warehouse size={18} className="mr-2" />
            Vista Silos
          </button>
          <button
            className={`flex items-center px-4 py-2 rounded-t font-medium ${activeTab === 'giacenze' ? 'bg-white shadow-md' : 'bg-gray-200 hover:bg-gray-300'}`}
            onClick={() => setActiveTab('giacenze')}
          >
            <Package size={18} className="mr-2" />
            Giacenze
          </button>
          <button
            className={`flex items-center px-4 py-2 rounded-t font-medium ${activeTab === 'report' ? 'bg-white shadow-md' : 'bg-gray-200 hover:bg-gray-300'}`}
            onClick={() => setActiveTab('report')}
          >
            <FileText size={18} className="mr-2" />
            Report
          </button>
        </div>
      </div>
      
      {/* Main Content */}
      <main className="container mx-auto px-4 pb-12">
        {activeTab === 'accettazione' && <AccettazioneTab />}
        {activeTab === 'silos' && <SilosTab />}
        {activeTab === 'giacenze' && <GiacenzeTab />}
        {activeTab === 'report' && <ReportTab />}
      </main>
      
      {/* Footer */}
      <footer className="bg-gray-800 text-white py-4">
        <div className="container mx-auto px-4 text-center text-sm">
          © 2025 Sistema Gestione Agrumi - v1.0 | Ultima sincronizzazione: 15/05/2025 15:30
        </div>
      </footer>
    </div>
  );
};

export default GestioneAgrumiApp;
